{
  "dashboard": {
    "id": null,
    "uid": "continuous-claude-performance",
    "title": "Continuous-Claude-v3 Performance",
    "description": "System performance monitoring: latency percentiles, resource usage, and bottleneck detection",
    "tags": ["continuous-claude", "performance", "latency", "bottleneck"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "30s",
    "panels": [
      {
        "id": 1,
        "title": "Query Latency p50",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "histogram_quantile(0.50, rate(pg_stat_statements_seconds_bucket[5m]))",
            "legendFormat": "PostgreSQL p50"
          },
          {
            "expr": "histogram_quantile(0.50, rate(redis_operation_latency_seconds_bucket[5m]))",
            "legendFormat": "Redis p50"
          },
          {
            "expr": "histogram_quantile(0.50, rate(recall_query_latency_seconds_bucket[5m]))",
            "legendFormat": "Recall p50"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "thresholdsStyle": {"mode": "line"},
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 0.01},
                {"color": "red", "value": 0.1}
              ]
            }
          }
        }
      },
      {
        "id": 2,
        "title": "Query Latency p95",
        "type": "timeseries",
        "gridPos": {"x": 6, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(pg_stat_statements_seconds_bucket[5m]))",
            "legendFormat": "PostgreSQL p95"
          },
          {
            "expr": "histogram_quantile(0.95, rate(redis_operation_latency_seconds_bucket[5m]))",
            "legendFormat": "Redis p95"
          },
          {
            "expr": "histogram_quantile(0.95, rate(recall_query_latency_seconds_bucket[5m]))",
            "legendFormat": "Recall p95"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "thresholdsStyle": {"mode": "line"},
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 0.1},
                {"color": "red", "value": 0.5}
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "title": "Query Latency p99",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "histogram_quantile(0.99, rate(pg_stat_statements_seconds_bucket[5m]))",
            "legendFormat": "PostgreSQL p99"
          },
          {
            "expr": "histogram_quantile(0.99, rate(redis_operation_latency_seconds_bucket[5m]))",
            "legendFormat": "Redis p99"
          },
          {
            "expr": "histogram_quantile(0.99, rate(recall_query_latency_seconds_bucket[5m]))",
            "legendFormat": "Recall p99"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "thresholdsStyle": {"mode": "line"},
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 0.5},
                {"color": "red", "value": 1}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "Baseline Comparison",
        "type": "timeseries",
        "gridPos": {"x": 18, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "rate(pg_stat_statements_seconds_sum[5m]) / rate(pg_stat_statements_seconds_count[5m])",
            "legendFormat": "Current Avg"
          },
          {
            "expr": "rate(pg_stat_statements_seconds_sum[24h]) / rate(pg_stat_statements_seconds_count[24h])",
            "legendFormat": "24h Avg"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "fillOpacity": 10,
              "lineWidth": 2
            }
          }
        }
      },
      {
        "id": 5,
        "title": "Embedding Generation Time",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 4, "w": 8, "h": 4},
        "targets": [
          {
            "expr": "histogram_quantile(0.50, rate(recall_embedding_latency_seconds_bucket[5m]))",
            "legendFormat": "Recall p50"
          },
          {
            "expr": "histogram_quantile(0.95, rate(recall_embedding_latency_seconds_bucket[5m]))",
            "legendFormat": "Recall p95"
          },
          {
            "expr": "histogram_quantile(0.50, rate(store_embedding_time_seconds_bucket[5m]))",
            "legendFormat": "Store p50"
          },
          {
            "expr": "histogram_quantile(0.95, rate(store_embedding_time_seconds_bucket[5m]))",
            "legendFormat": "Store p95"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "thresholdsStyle": {"mode": "line"},
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 0.5},
                {"color": "red", "value": 2}
              ]
            }
          }
        }
      },
      {
        "id": 6,
        "title": "Memory Usage Over Time",
        "type": "timeseries",
        "gridPos": {"x": 8, "y": 4, "w": 8, "h": 4},
        "targets": [
          {
            "expr": "process_memory_bytes{type=\"rss\"} / 1024 / 1024",
            "legendFormat": "RSS (MB)"
          },
          {
            "expr": "process_memory_bytes{type=\"vms\"} / 1024 / 1024",
            "legendFormat": "VMS (MB)"
          },
          {
            "expr": "redis_memory_bytes / 1024 / 1024",
            "legendFormat": "Redis (MB)"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "MB",
            "custom": {
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 512},
                {"color": "red", "value": 1024}
              ]
            }
          }
        }
      },
      {
        "id": 7,
        "title": "CPU Usage Over Time",
        "type": "timeseries",
        "gridPos": {"x": 16, "y": 4, "w": 8, "h": 4},
        "targets": [
          {
            "expr": "rate(process_cpu_percent[5m]) * 100",
            "legendFormat": "CPU %"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "custom": {
              "fillOpacity": 20
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 70},
                {"color": "red", "value": 90}
              ]
            }
          }
        }
      },
      {
        "id": 8,
        "title": "PostgreSQL Pool Utilization",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "pg_pool_connections_busy / pg_pool_connections_max * 100",
            "legendFormat": "Busy %"
          },
          {
            "expr": "pg_pool_connections_idle / pg_pool_connections_max * 100",
            "legendFormat": "Idle %"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "custom": {
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 70},
                {"color": "red", "value": 90}
              ]
            }
          }
        }
      },
      {
        "id": 9,
        "title": "Connection Pool Waiters",
        "type": "timeseries",
        "gridPos": {"x": 6, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "postgres_pool_waiters",
            "legendFormat": "Waiters"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "custom": {
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 5},
                {"color": "red", "value": 20}
              ]
            }
          }
        }
      },
      {
        "id": 10,
        "title": "Pool Acquire Time",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "histogram_quantile(0.50, rate(postgres_pool_acquire_time_seconds_bucket[5m]))",
            "legendFormat": "p50"
          },
          {
            "expr": "histogram_quantile(0.95, rate(postgres_pool_acquire_time_seconds_bucket[5m]))",
            "legendFormat": "p95"
          },
          {
            "expr": "histogram_quantile(0.99, rate(postgres_pool_acquire_time_seconds_bucket[5m]))",
            "legendFormat": "p99"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "thresholdsStyle": {"mode": "line"}
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 0.05},
                {"color": "red", "value": 0.2}
              ]
            }
          }
        }
      },
      {
        "id": 11,
        "title": "Redis Operations Rate",
        "type": "timeseries",
        "gridPos": {"x": 18, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "rate(redis_operations_total[5m])",
            "legendFormat": "{{operation}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ops/s",
            "custom": {
              "fillOpacity": 10
            }
          }
        }
      },
      {
        "id": 12,
        "title": "Latency Heatmap (All Operations)",
        "type": "heatmap",
        "gridPos": {"x": 0, "y": 12, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "sum by (le, operation) (rate(redis_operation_latency_seconds_bucket[5m]))",
            "legendFormat": "{{operation}}"
          },
          {
            "expr": "sum by (le, query_type) (rate(pg_stat_statements_seconds_bucket[5m]))",
            "legendFormat": "{{query_type}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "cellPadding": 2
            }
          }
        }
      },
      {
        "id": 13,
        "title": "Throughput vs Latency",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 12, "w": 6, "h": 6},
        "targets": [
          {
            "expr": "rate(pg_stat_statements_seconds_count[5m])",
            "legendFormat": "Queries/s"
          },
          {
            "expr": "histogram_quantile(0.95, rate(pg_stat_statements_seconds_bucket[5m])) * 1000",
            "legendFormat": "Latency p95 (ms)"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "custom": {
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 100},
                {"color": "red", "value": 500}
              ]
            }
          }
        }
      },
      {
        "id": 14,
        "title": "Thread Count",
        "type": "timeseries",
        "gridPos": {"x": 18, "y": 12, "w": 6, "h": 6},
        "targets": [
          {
            "expr": "process_thread_count",
            "legendFormat": "Threads"
          },
          {
            "expr": "process_max_threads",
            "legendFormat": "Max"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "custom": {
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 50},
                {"color": "red", "value": 100}
              ]
            }
          }
        }
      },
      {
        "id": 15,
        "title": "PostgreSQL Active Transactions",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 18, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "postgres_active_transactions",
            "legendFormat": "Active"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "custom": {
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 50},
                {"color": "red", "value": 100}
              ]
            }
          }
        }
      },
      {
        "id": 16,
        "title": "PostgreSQL Queries by Type",
        "type": "timeseries",
        "gridPos": {"x": 6, "y": 18, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "rate(pg_stat_statements_total{query_type=\"select\"}[5m])",
            "legendFormat": "Select"
          },
          {
            "expr": "rate(pg_stat_statements_total{query_type=\"insert\"}[5m])",
            "legendFormat": "Insert"
          },
          {
            "expr": "rate(pg_stat_statements_total{query_type=\"update\"}[5m])",
            "legendFormat": "Update"
          },
          {
            "expr": "rate(pg_stat_statements_total{query_type=\"delete\"}[5m])",
            "legendFormat": "Delete"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ops/s",
            "custom": {
              "fillOpacity": 10
            }
          }
        }
      },
      {
        "id": 17,
        "title": "GC Activity",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 18, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "rate(process_gc_collects_total[5m])",
            "legendFormat": "GC runs gen {{generation}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ops/s",
            "custom": {
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 10},
                {"color": "red", "value": 50}
              ]
            }
          }
        }
      },
      {
        "id": 18,
        "title": "GC Time",
        "type": "timeseries",
        "gridPos": {"x": 18, "y": 18, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "rate(process_gc_time_seconds_total[5m])",
            "legendFormat": "GC time gen {{generation}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s/s",
            "custom": {
              "fillOpacity": 10
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 0.1},
                {"color": "red", "value": 0.5}
              ]
            }
          }
        }
      }
    ],
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": {"type": "grafana", "uid": "-- Grafana --"},
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "type": "dashboard"
        }
      ]
    },
    "templating": {
      "list": [
        {
          "current": {"selected": false, "text": "All", "value": "$__all"},
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "definition": "label_values(pg_stat_statements, query_type)",
          "hide": 0,
          "includeAll": true,
          "label": "Query Type",
          "multi": true,
          "name": "query_type",
          "options": [],
          "query": "label_values(pg_stat_statements, query_type)",
          "refresh": 2,
          "regex": "",
          "skipUrlSync": false,
          "sort": 1,
          "type": "query"
        },
        {
          "current": {"selected": false, "text": "All", "value": "$__all"},
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "definition": "label_values(redis_operations_total, operation)",
          "hide": 0,
          "includeAll": true,
          "label": "Redis Operation",
          "multi": true,
          "name": "redis_operation",
          "options": [],
          "query": "label_values(redis_operations_total, operation)",
          "refresh": 2,
          "regex": "",
          "skipUrlSync": false,
          "sort": 1,
          "type": "query"
        },
        {
          "current": {"selected": false, "text": "All", "value": "$__all"},
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "definition": "label_values(pg_stat_activity, state)",
          "hide": 0,
          "includeAll": true,
          "label": "PG State",
          "multi": true,
          "name": "pg_state",
          "options": [],
          "query": "label_values(pg_stat_activity, state)",
          "refresh": 2,
          "regex": "",
          "skipUrlSync": false,
          "sort": 1,
          "type": "query"
        },
        {
          "current": {"selected": false, "text": "1h", "value": "1h"},
          "hide": 0,
          "includeAll": false,
          "label": "Baseline Window",
          "multi": false,
          "name": "baseline_window",
          "options": [{"text": "1h", "value": "1h"}, {"text": "6h", "value": "6h"}, {"text": "24h", "value": "24h"}, {"text": "7d", "value": "7d"}],
          "query": "1h, 6h, 24h, 7d",
          "refresh": 2,
          "skipUrlSync": false,
          "sort": 1,
          "type": "interval"
        }
      ]
    },
    "time": {
      "from": "now-6h",
      "to": "now"
    },
    "timepicker": {
      "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"]
    },
    "links": [
      {
        "title": "Overview Dashboard",
        "type": "link",
        "url": "/d/continuous-claude-overview/overview",
        "icon": "home",
        "targetBlank": false
      },
      {
        "title": "Memory System Dashboard",
        "type": "link",
        "url": "/d/continuous-claude-memory/memory-system",
        "icon": "database",
        "targetBlank": false
      },
      {
        "title": "Stream Monitoring Dashboard",
        "type": "link",
        "url": "/d/continuous-claude-stream/stream-monitoring",
        "icon": "stream",
        "targetBlank": false
      },
      {
        "title": "MCP Clients Dashboard",
        "type": "link",
        "url": "/d/continuous-claude-mcp/mcp-clients",
        "icon": "plug",
        "targetBlank": false
      }
    ]
  },
  "overwrite": true,
  "message": "Created Performance dashboard"
}
